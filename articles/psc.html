<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>psc-vignette • psc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="psc-vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">psc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/psc.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/richJJackson/psc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>psc-vignette</h1>
                        <h4 data-toc-skip class="author">Richard
Jackson</h4>
            
            <h4 data-toc-skip class="date">2025-11-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/richJJackson/psc/blob/main/vignettes/psc.Rmd" class="external-link"><code>vignettes/psc.Rmd</code></a></small>
      <div class="d-none name"><code>psc.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The psc.R package implements the methods for applying Personalised
Synthetic Controls, which allows for patients receiving some
experimental treatment to be compared against a model which predicts
their reponse to some control. This is a form of causal inference which
differes from other approaches in that</p>
Data are only required on a single treatment - all counterfactual
evidence is supplied by a parametric model
<p>Causal inference, in theory at least, is estimated at a patient level
- as opposed to estimating average effects over a population</p>
<p>The causal estimand obtained is the Average Treatment Effect of the
Treated (ATT) which differs from the Average Treatment Effect (ATE)
obtained in other settings and addresses the question of whether
treatments are effective in the population of patients who are treated.
This estimand then targets efficacy over effectivness.</p>
<p>In its basic form, this method creates a likelihood to compare a
cohort of data to a parametric model. See (X) for disucssion on it’s use
as a causal inference tool. To use this package, two basic peices of
information are required, a dataset and a model against which they can
be compared.</p>
<p>In this vignette, we will detail how the psc.r package is constructed
and give some examples for it’s application in practice.</p>
</div>
<div class="section level2">
<h2 id="methodology">Methodology<a class="anchor" aria-label="anchor" href="#methodology"></a>
</h2>
<p>The <code>pscfit</code> function compares a dataset (‘DC’) against a
parametric model. This is done by selecting a likelihood which is
identified by the type of CFM that is supplied. At present, two types of
model are supported, a flexible parmaeteric survival model of type
‘flexsurvreg’ and a geleneralised linear model of type ‘glm’.</p>
<p>Where the CFM is of type ‘flexsurvreg’ the likeihood supplied is of
the form:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>D</mi><mo>∣</mo><mi>Λ</mi><mo>,</mo><msub><mi>Γ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>f</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo>∣</mo><mi>Λ</mi><mo>,</mo><msub><mi>Γ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>c</mi><mi>i</mi></msub></msup><mi>S</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>i</mi></msub><mo>∣</mo><mi>Γ</mi><mo>,</mo><msub><mi>Λ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><msub><mi>c</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">L(D∣\Lambda,\Gamma_i)=\prod_{i=1}^{n} f(t_i∣\Lambda,\Gamma_i)^{c_i} 
S(t_i∣\Gamma,\Lambda_i)^{(1−c_i)}</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>
defines the cumulative baseline hazard function,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>
is the linear predictor and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>
are the event time and indicator variables.</p>
<p>Where the CFM is of the type ‘glm’ the likelihood supplied is of the
form:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>∣</mo><msub><mi>Γ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo>∣</mo><msub><mi>Γ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>Γ</mi><mi>i</mi></msub><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Γ</mi><mi>i</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">L(x∣\Gamma_i) = \prod_{i=1}^{n} b (x∣ \Gamma_i )\exp\{\Gamma_i t(x)−
c(\Gamma_i)\}</annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b(.)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">t(.)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>.</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">c(.)</annotation></semantics></math>
represent the functions of the exponential family. In both cases,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>
is defiend as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Γ</mi><mi>i</mi></msub><mo>=</mo><mi>γ</mi><msub><mi>x</mi><mi>i</mi></msub><mo>+</mo><mi>β</mi></mrow><annotation encoding="application/x-tex"> \Gamma_i = \gamma x_i+\beta </annotation></semantics></math></p>
<p>Where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>γ</mi><annotation encoding="application/x-tex">\gamma</annotation></semantics></math>
are the model coefficients supplied by the CFM and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is the parameter set to measure the difference between the CFM and the
DC.</p>
<p>Estimation is performed using a Bayesian MCMC procedure. Prior
distributions for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Γ</mi><annotation encoding="application/x-tex">\Gamma</annotation></semantics></math>
(&amp;
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Λ</mi><annotation encoding="application/x-tex">\Lambda</annotation></semantics></math>)
are derived directly from the model coefficients (mean and variance
covariance matrix) or the CFM. A bespoke MCMC routine is performed to
estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>.
Please see ‘?mcmc’ for more detials.</p>
<p>For the standard example where the DC contains information from only
a single treatment, trt need not be specified. Where comparisons between
the CFM and multiple treatments are require, a covariate of treamtne
allocations must be specified sperately (using the ‘trt’ option).</p>
</div>
<div class="section level2">
<h2 id="package-structure">Package Structure<a class="anchor" aria-label="anchor" href="#package-structure"></a>
</h2>
<p>The main function for using applying Personal Synthetic Controls is
the pscfit() function which has two inputs, a Counter-Factual Model
(CFM) and a data cohort (DC). Further arguments include</p>
<ul>
<li>nsim which sets the number of MCMC iterations (defaults to
5000)</li>
<li>‘id’ if the user wishes to restrict estimation to a sub-set (or
individual) within the DC</li>
<li>‘trt’ to be used as an initial identifier if mulitple treatment
comparisons are to be made (please see the Mulitple Treatment Comparison
below)</li>
</ul>
<div class="section level3">
<h3 id="psc-object">psc object<a class="anchor" aria-label="anchor" href="#psc-object"></a>
</h3>
<p>The output of the “pscfit()” function is an object of class ‘psc’.
This class contains the following attributes</p>
<ul>
<li>A definition of the calss of the model supplied</li>
<li>A ‘cleaned’ dataset including extracted components of the CFM and
the cleaned DC included in the procedure</li>
<li>An object defingin the class of model (and therefore the procedure
applied - see above)</li>
<li>A matrix containing the draws of the posterior distributions</li>
</ul>
</div>
<div class="section level3">
<h3 id="postestimation-functions">Postestimation functions<a class="anchor" aria-label="anchor" href="#postestimation-functions"></a>
</h3>
<p>basic post estimation functions have been developed to work with the
psc object, namely “print()”, “coef()”, “summary()” and “plot()”. For
the first three of these these provided basic summaries of the efficacy
parameter obtained from the posterior distribution.</p>
</div>
</div>
<div class="section level2">
<h2 id="motivating-example">Motivating Example<a class="anchor" aria-label="anchor" href="#motivating-example"></a>
</h2>
<p>The psc.r package includes as example a dataset “e4_data” which is
derived from patients ith pancreatic ductal adenocarcinoma (PDAC) who
have all received some experimental treatment, in this case GemCap.
Aside from this we also provide a Counter Factual Model (CFM) for
patients in the same setting (named ‘gemCFM’) to receive a therapy
called ‘Gem’. The aim here is to produce a ‘GemCap Vs Gem’ comparison.
We start by loading the package and from there obtianing the data and
the model for analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/remove.packages.html" class="external-link">remove.packages</a></span><span class="op">(</span><span class="st">"psc"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing package from '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span><span class="co">#rm(list=ls())</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: usethis</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"richjjackson/psc"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using github PAT from envvar GITHUB_PAT. Use `gitcreds::gitcreds_set()` and unset GITHUB_PAT in .Renviron (or elsewhere) if you want to use the more secure git credential store instead.</span></span>
<span><span class="co">#&gt; Downloading GitHub repo richjjackson/psc@HEAD</span></span>
<span><span class="co">#&gt; digest (0.6.37 -&gt; 0.6.38) [CRAN]</span></span>
<span><span class="co">#&gt; lsoda  (NA     -&gt; 1.2   ) [CRAN]</span></span>
<span><span class="co">#&gt; rstpm2 (1.7.0  -&gt; 1.7.1 ) [CRAN]</span></span>
<span><span class="co">#&gt; Installing 3 packages: digest, lsoda, rstpm2</span></span>
<span><span class="co">#&gt; Installing packages into '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="color: #00BBBB;">R CMD build</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; * checking for file ‘/tmp/RtmpK9RbPL/remotes216639ea9ef3/richJJackson-psc-94482ab/DESCRIPTION’ ... OK</span></span>
<span><span class="co">#&gt; * preparing ‘psc’:</span></span>
<span><span class="co">#&gt; * checking DESCRIPTION meta-information ... OK</span></span>
<span><span class="co">#&gt; * checking for LF line-endings in source and make files and shell scripts</span></span>
<span><span class="co">#&gt; * checking for empty or unneeded directories</span></span>
<span><span class="co">#&gt; * building ‘psc_2.0.0.tar.gz’</span></span>
<span><span class="co">#&gt; Installing package into '/home/runner/work/_temp/Library'</span></span>
<span><span class="co">#&gt; (as 'lib' is unspecified)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/richjjackson/psc/" class="external-link">psc</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: survival</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span><span class="va">e4_data</span> <span class="op">&lt;-</span> <span class="fu">psc</span><span class="fu">::</span><span class="va"><a href="../reference/e4_data.html">e4_data</a></span></span>
<span><span class="va">gemCFM</span> <span class="op">&lt;-</span> <span class="fu">psc</span><span class="fu">::</span><span class="va"><a href="../reference/gemCFM.html">gemCFM</a></span></span></code></pre></div>
<p>#<code>{r} #library(parallel) #library(posterior) #library(ggplot2) #library(survminer) #library(ggpubr) #library(survival) #</code></p>
<p>Starting with the model, we can inspect the model terms included in
the counter factual model using</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gemCFM</span><span class="op">$</span><span class="va">terms</span></span>
<span><span class="co">#&gt; [1] "LymphN"      "ResecM"      "Diff_Status" "PostOpCA199" "(weights)"</span></span></code></pre></div>
<p>Included is a list of prognostic covariates:</p>
<ul>
<li>Lymph Nodes: patient lymph node status; negative (n=1) or positive
(n=2) lymph nodes</li>
<li>Diff_Status: tumour grade; 1,2 or 3</li>
<li>PostOpCA199: log transformed ca19.9</li>
</ul>
<p>Similarly we can observe the outcome terms. As the gemCFM object is a
survival model this includes terms named “time” and “cen”. NB the pscfit
function will search for these terms and so it is important that
outcomes included in the data cohort (DC) are labelled in the same
way.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gemCFM</span><span class="op">$</span><span class="va">out.nm</span></span>
<span><span class="co">#&gt; [1] "time" "cen"</span></span></code></pre></div>
<p>Importantly the covariates included in the DC must have names which
match these.<br>
Prior to comparing the DC to the CFM then it is advisable to get an good
understanding of the data included in the CFM. Within the CFM object
there are a series of plots to visualise the covariate values which can
be extracted using the ‘plotCFM’ function</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCFM.html">plotCFM</a></span><span class="op">(</span><span class="va">gemCFM</span><span class="op">)</span></span></code></pre></div>
<p><img src="psc_files/figure-html/unnamed-chunk-5-1.png" class="r-plt" width="672"></p>
<p>We give esamples of how the ‘pscfit()’ function can be used to
comapre data against models with survival outcomes (with a ‘flexsurvreg’
model). Examples on how to perform analyses using GLM model objects are
available from the github repo <a href="https://github.com/richJJackson/psc" class="external-link uri">https://github.com/richJJackson/psc</a></p>
<div class="section level3">
<h3 id="survival-example">Survival Example<a class="anchor" aria-label="anchor" href="#survival-example"></a>
</h3>
<p>For an example with a survival outcome a model must be supplied which
is contructed ont he basis of flexible parametric splines. This is
contructed using the “flexsurvreg” function within the “flexsurv”
package. An example is included within the ‘psc.r’ package names
‘surv.mod’ and is loaded using the ’data()” function:</p>
<p>The ‘gemCFM’ is an object of class pscCFM which means it contains all
of the structures required for analysis but has stripped the model
object of any patient level data. Please note that the psc package can
be used by providing standard ‘glm’ or ‘flexsurvreg’ models. Here the
procedures will convert the model into a ‘pscCFM’ object using the
pscCFM() function.</p>
<p>In this example the ‘gemCFM’ model is constructed with 5 internal
knots and hence 7 parameters to describe the baseline cumulative hazard
function:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gemCFM</span><span class="op">$</span><span class="va">haz_co</span></span>
<span><span class="co">#&gt;      gamma0      gamma1      gamma2      gamma3      gamma4      gamma5 </span></span>
<span><span class="co">#&gt; -11.3808020   3.8359818   1.2911623  -1.3176560   1.1190182  -0.8876277 </span></span>
<span><span class="co">#&gt;      gamma6 </span></span>
<span><span class="co">#&gt;   0.3372484</span></span></code></pre></div>
<p>There are also prognostic covariates which match with the prognostic
covariates in the data cohort….</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gemCFM</span><span class="op">$</span><span class="va">cov_co</span></span>
<span><span class="co">#&gt;      LymphN1      ResecM1 Diff_Status1 Diff_Status2  PostOpCA199 </span></span>
<span><span class="co">#&gt;    0.4876152    0.1805322   -0.4160534   -0.5897823    0.2671471</span></span></code></pre></div>
<p>The process of comparing the DC to the CFM occures across 4
steps:</p>
<ul>
<li>Step 1: Combine/Compare the DC and the CFM using the pscData()
function</li>
<li>Step 2: Obtain initial values for the estimation procedue using
init()</li>
<li>Step 3: Run the MCMC estimation procedure</li>
<li>Step 4: Collate and summarise the results</li>
</ul>
<p>Each of these steps update a ‘pscOb’ object resutls which is returned
to the user. This process is wrapped up in a single ‘pscfit()’
function/</p>
<p>NB. A warning is supplied here just to note that data have been
removed form the DC prior to analysis due to missing data.</p>
<p>We can view the attributes of the psc object that is created. This
includes details on all components including the CFM, the DC, the
likelihood applied, the starting values and posterior distribuion</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">surv.psc</span><span class="op">)</span></span>
<span><span class="co">#&gt; $names</span></span>
<span><span class="co">#&gt;  [1] "mod_class" "terms"     "out.nm"    "cov_class" "cov_lev"   "co"       </span></span>
<span><span class="co">#&gt;  [7] "cov_co"    "sig"       "haz_co"    "k"         "kn"        "lam"      </span></span>
<span><span class="co">#&gt; [13] "formula"   "datasumm"  "datavis"   "DC"        "lik"       "start.mu" </span></span>
<span><span class="co">#&gt; [19] "start.sd"  "cfmPost"   "target"    "betaPrior" "ncores"    "draws"    </span></span>
<span><span class="co">#&gt; [25] "postFit"   "postEst"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $class</span></span>
<span><span class="co">#&gt; [1] "psc"</span></span></code></pre></div>
<p>Its worth noting that as part of the ‘pscData()’ function which
ensures the DC and CFM are compatible - the ‘datavis’ object has been
updated. This will now produce a useful figure to allow evaulation of
how comparable the data from the CFM and DC are using the ‘plotCFM()’
function</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCFM.html">plotCFM</a></span><span class="op">(</span><span class="va">surv.psc</span><span class="op">)</span></span></code></pre></div>
<p><img src="psc_files/figure-html/unnamed-chunk-10-1.png" class="r-plt" width="672"></p>
<p>We make use of the ‘posterior’ package to summarise the posterior
distributions (saved within the ‘draws’ object). Both ‘print()’ and
‘coef()’ will show these although the ‘summary()’ function provides mode
information:</p>
<p>This includes information on the underlying CFM as well as expected
meand response for patients in the DC along with 95% CI (obtianed using
bootstrapping). A summary of the MCMC fit is supplied along with the
overall summary of the posterior distribution.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">surv.psc</span><span class="op">)</span></span>
<span><span class="co">#&gt; Counterfactual Model (CFM): </span></span>
<span><span class="co">#&gt; A model of class 'flexsurvreg' </span></span>
<span><span class="co">#&gt;  Fit with 5 internal knots</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; CFM Formula: </span></span>
<span><span class="co">#&gt; Surv(time, cen) ~ LymphN + ResecM + Diff_Status + PostOpCA199</span></span>
<span><span class="co">#&gt; &lt;environment: 0x558001604080&gt;</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; CFM Summary: </span></span>
<span><span class="co">#&gt; Expected response for the outcome under the CFM:</span></span>
<span><span class="co">#&gt;     S     lo     hi  </span></span>
<span><span class="co">#&gt; 30.30  25.51  35.79  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Observed outcome from the Data Cohort:</span></span>
<span><span class="co">#&gt;          [,1] </span></span>
<span><span class="co">#&gt; median   26.33</span></span>
<span><span class="co">#&gt; 0.95LCL  22.85</span></span>
<span><span class="co">#&gt; 0.95UCL  31.03</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MCMC Fit: </span></span>
<span><span class="co">#&gt; Posterior Distribution obtaine with fit summary:</span></span>
<span><span class="co">#&gt;       variable    rhat        ess_bulk    ess_tail    mcse_mean </span></span>
<span><span class="co">#&gt; [1,]  beta_1      1.003578    933.1359    1069.9      0.00278219</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary: </span></span>
<span><span class="co">#&gt; Posterior Distribution for beta:Call:</span></span>
<span><span class="co">#&gt;  CFM model + beta</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;            variable      mean          sd            median        q5          </span></span>
<span><span class="co">#&gt; posterior  beta_1        -0.004570621  0.08599047    -0.002258437  -0.1444204  </span></span>
<span><span class="co">#&gt;            q95         </span></span>
<span><span class="co">#&gt; posterior  0.1341535</span></span></code></pre></div>
<p>Lastly to visualise the original model and the fit of the data, the
plot function has been included</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">surv.psc</span><span class="op">)</span></span>
<span><span class="co">#&gt;            variable      mean          sd            median        q5          </span></span>
<span><span class="co">#&gt; posterior  beta_1        -0.004570621  0.08599047    -0.002258437  -0.1444204  </span></span>
<span><span class="co">#&gt;            q95         </span></span>
<span><span class="co">#&gt; posterior  0.1341535</span></span>
<span><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Please use `linewidth` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The deprecated feature was likely used in the <span style="color: #0000BB;">ggpubr</span> package.</span></span>
<span><span class="co">#&gt;   Please report the issue at <span style="color: #0000BB; font-style: italic;">&lt;https://github.com/kassambara/ggpubr/issues&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span>
<span><span class="co">#&gt; Ignoring unknown labels:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="color: #00BB00;">colour</span> : <span style="color: #0000BB;">"Strata"</span></span></span></code></pre></div>
<p><img src="psc_files/figure-html/unnamed-chunk-12-1.png" class="r-plt" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Richard Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
